<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–†—É–†—É–º | –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="app-container" id="appScreen">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button class="mobile-menu-toggle" aria-label="–ú–µ–Ω—é">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo">
                        <div class="logo-icon">
                            <img src="https://i.ibb.co/yFzHxQWf/logo.png" alt="–†—É–†—É–º" class="logo-image">
                            <div class="online-dot"></div>
                        </div>
                        <span>–†—É–†—É–º</span>
                    </div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="icon-btn new-chat-btn" aria-label="–ù–æ–≤–∞—è –±–µ—Å–µ–¥–∞">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="icon-btn add-friend-btn" aria-label="–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞">
                        <i class="fas fa-user-plus"></i>
                    </button>
                    <button class="icon-btn settings-btn" id="settingsBtn" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="sidebar-nav">
                <button class="nav-btn active" data-tab="chats">
                    <i class="fas fa-comments"></i>
                    <span>–ß–∞—Ç—ã</span>
                </button>
                <button class="nav-btn" data-tab="friends">
                    <i class="fas fa-user-friends"></i>
                    <span>–î—Ä—É–∑—å—è</span>
                    <span class="nav-badge" id="friendsBadge">0</span>
                </button>
            </div>

            <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="user-welcome">
                <div class="welcome-avatar" id="userAvatarContainer">
                    <div class="avatar-placeholder user" id="userAvatar">–ü</div>
                    <div class="avatar-upload">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <div class="welcome-text">
                    <div class="welcome-name" id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="welcome-message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                </div>
            </div>

            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-container">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫...">
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —á–∞—Ç–æ–≤ -->
            <div class="tab-content active" id="chatsTab">
                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                <div class="chats-list">
                    <!-- –ß–∞—Ç-–ª–∏—Å—Ç –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>–ù–µ—Ç –±–µ—Å–µ–¥</h3>
                    <p>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–≤ –Ω–æ–≤—É—é –±–µ—Å–µ–¥—É</p>
                    <button class="start-chat-btn">
                        <i class="fas fa-plus"></i>
                        –ù–∞—á–∞—Ç—å –±–µ—Å–µ–¥—É
                    </button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –¥—Ä—É–∑–µ–π -->
            <div class="tab-content" id="friendsTab">
                <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
                <div class="friends-list">
                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π -->
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <h3>–ù–µ—Ç –¥—Ä—É–∑–µ–π</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–∑–µ–π —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
                    <button class="start-chat-btn">
                        <i class="fas fa-user-plus"></i>
                        –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞
                    </button>
                </div>
            </div>

            <!-- –§—É—Ç–µ—Ä –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="avatar-placeholder small" id="footerUserAvatar">–ü</div>
                    <div class="user-info">
                        <div class="user-name" id="footerUserName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="user-status">online</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
        <div class="chat-area">
            <!-- –ú–æ–±–∏–ª—å–Ω—ã–π —Ö–µ–¥–µ—Ä -->
            <div class="mobile-chat-header" style="display: none;">
                <button class="mobile-back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="mobile-chat-info">
                    <div class="avatar-placeholder small" id="mobileChatAvatar">–ß</div>
                    <div class="mobile-partner-details">
                        <div class="partner-name" id="mobilePartnerName">–ë–µ—Å–µ–¥–∞</div>
                        <div class="partner-status">online</div>
                    </div>
                </div>
                <button class="mobile-chat-menu">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
            <div class="welcome-screen">
                <div class="welcome-content">
                    <div class="welcome-icon">
                        <img src="https://i.ibb.co/yFzHxQWf/logo.png" alt="–†—É–†—É–º" class="logo-image large">
                    </div>
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –†—É–†—É–º!</h1>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –±–µ—Å–µ–¥—É –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏</p>
                    <div class="welcome-features">
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <span>–ë–µ–∑–æ–ø–∞—Å–Ω–æ</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-bolt"></i>
                            <span>–ë—ã—Å—Ç—Ä–æ</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-user-friends"></i>
                            <span>–î—Ä—É–∑—å—è</span>
                        </div>
                    </div>
                    <div class="mobile-start-buttons" style="display: none;">
                        <button class="start-chat-btn mobile-btn">
                            <i class="fas fa-plus"></i>
                            –ù–æ–≤–∞—è –±–µ—Å–µ–¥–∞
                        </button>
                        <button class="start-chat-btn mobile-btn">
                            <i class="fas fa-user-plus"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞
                        </button>
                    </div>
                    <!-- –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —á–∞—Ç–∞ -->
                    <div class="test-chat-container">
                        <button class="test-chat-btn" id="testBtn">
                            <i class="fas fa-vial"></i>
                            –í–æ–π—Ç–∏ –≤ —Ç–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç
                        </button>
                        <p class="test-chat-hint">–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</p>
                    </div>
                </div>
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç -->
            <div class="active-chat" style="display: none;">
                <div class="chat-header">
                    <div class="chat-partner-info">
                        <div class="avatar-placeholder small" id="chatPartnerAvatar">–ß</div>
                        <div class="partner-details">
                            <div class="partner-name" id="chatPartnerName">–ë–µ—Å–µ–¥–∞</div>
                            <div class="partner-status">online</div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="action-btn" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div class="messages-container">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="message-input-container">
                    <div class="input-wrapper">
                        <textarea class="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1"></textarea>
                    </div>
                    <button class="send-btn" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay" id="newChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–æ–≤–∞—è –±–µ—Å–µ–¥–∞</h3>
                <button class="close-modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="chatNameInput">–ù–∞–∑–≤–∞–Ω–∏–µ –±–µ—Å–µ–¥—ã</label>
                    <input type="text" id="chatNameInput" class="chat-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–µ—Å–µ–¥—ã">
                    <div class="input-hint">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —á–∞—Ç–∞</div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary create-chat-btn">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addFriendModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h3>
                <button class="close-modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="friendNameInput">–ò–º—è –¥—Ä—É–≥–∞</label>
                    <input type="text" id="friendNameInput" class="chat-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è">
                    <div class="input-hint">–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary cancel-add-friend-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary add-friend-confirm-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                <button class="close-modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>–ê–≤–∞—Ç–∞—Ä</h4>
                    <div class="avatar-settings">
                        <div class="avatar-preview">
                            <div class="avatar-placeholder large" id="settingsAvatarPreview">–ü</div>
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            <button class="avatar-upload-btn">
                                <i class="fas fa-camera"></i>
                                –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                            </button>
                        </div>
                        <div class="avatar-colors">
                            <div class="color-option" data-color="#f6a75e" style="background: #f6a75e;"></div>
                            <div class="color-option" data-color="#FF6B6B" style="background: #FF6B6B;"></div>
                            <div class="color-option" data-color="#4ECDC4" style="background: #4ECDC4;"></div>
                            <div class="color-option" data-color="#45B7D1" style="background: #45B7D1;"></div>
                            <div class="color-option" data-color="#96CEB4" style="background: #96CEB4;"></div>
                            <div class="color-option" data-color="#FFEAA7" style="background: #FFEAA7;"></div>
                            <div class="color-option" data-color="#DDA0DD" style="background: #DDA0DD;"></div>
                            <div class="color-option" data-color="#FFA07A" style="background: #FFA07A;"></div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h4>
                    <div class="form-group">
                        <label for="userNameInput">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="userNameInput" class="settings-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                    </div>
                    <div class="form-group">
                        <label for="userStatusInput">–°—Ç–∞—Ç—É—Å</label>
                        <input type="text" id="userStatusInput" class="settings-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Å—Ç–∞—Ç—É—Å">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h4>
                    <div class="theme-options">
                        <label class="theme-option">
                            <input type="radio" name="theme" value="light" checked>
                            <span class="theme-checkmark"></span>
                            –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="dark">
                            <span class="theme-checkmark"></span>
                            –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                        </label>
                </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary cancel-settings-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary save-settings-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤—å—Ç–µ Ably –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ -->
    <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
        console.log('üöÄ Starting Rurum Messenger with Ably...');
        
        // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∞–¥–∫–∏ –î–û –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–∞
        window.debugData = function() {
            console.log('üêõ DEBUG DATA:');
            if (window.messenger) {
                console.log('Chats:', messenger.chats);
                console.log('Friends:', messenger.friends);
                console.log('Current Chat:', messenger.currentChat);
                console.log('User:', messenger.currentUser);
                console.log('Used Names:', Array.from(messenger.usedNames));
                console.log('Messages:', Array.from(messenger.messages.entries()));
                console.log('Ably connected:', messenger.ably ? messenger.ably.connection.state : 'No');
                console.log('Ably channel:', messenger.channel ? messenger.channel.name : 'No channel');
            } else {
                console.log('‚ùå Messenger not initialized yet');
            }
        };

        window.testAbly = function() {
            console.log('üîß Testing Ably connection...');
            if (window.messenger && messenger.ably) {
                console.log('Ably connection state:', messenger.ably.connection.state);
                console.log('Ably channel:', messenger.channel ? messenger.channel.name : 'No channel');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (messenger.ably.connection.state === 'connected') {
                    messenger.showMessage('‚úÖ Ably –ø–æ–¥–∫–ª—é—á–µ–Ω! –°–æ—Å—Ç–æ—è–Ω–∏–µ: ' + messenger.ably.connection.state, 'success');
                } else {
                    messenger.showMessage('‚ö†Ô∏è Ably —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ' + messenger.ably.connection.state, 'warning');
                }
            } else {
                console.log('‚ùå Ably not initialized');
                if (window.messenger) {
                    messenger.showMessage('‚ùå Ably –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                } else {
                    alert('Messenger not loaded yet');
                }
            }
        };

        window.joinTest = function() {
            console.log('üß™ Joining test chat...');
            if (window.messenger) {
                messenger.joinTestChat();
            } else {
                console.log('‚ùå Messenger not initialized yet');
                alert('–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            }
        };

        window.clearData = function() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É.')) {
                localStorage.clear();
                location.reload();
            }
        };

        // –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
        document.write('<script src="script.js"><\/script>');
    </script>
</body>
</html>